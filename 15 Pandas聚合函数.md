# 15 Pandas聚合函数

我们知道，窗口函数可以与聚合函数一起使用，聚合函数指的是对一组数据求总和、最大值、最小值以及平均值的操作，本节重点讲解聚合函数的应用。

## 应用聚合函数

使用aggregate()在指定轴上使用一项或多项操作进行聚合

首先让我们创建一个 DataFrame 对象，然后对聚合函数进行应用。

```python
import pandas as pd
import numpy as np
df = pd.DataFrame(np.random.randn(5, 4),index = pd.date_range('12/14/2022', periods=5),columns = ['A', 'B', 'C', 'D'])
print (df)
#窗口大小为3，min_periods 最小观测值为1
r = df.rolling(window=3,min_periods=1)
print(r) 
```

输出结果：

```
                   A         B         C         D
2022-12-14  0.365679  1.605576  0.094622  1.367596
2022-12-15 -0.003054 -0.311650  1.476279 -0.252426
2022-12-16  0.702722  0.444366  1.214280 -0.890047
2022-12-17 -0.265698 -1.174423  1.695452 -0.079901
2022-12-18 -0.266886  0.498338 -1.803101 -1.296304

Rolling [window=3,min_periods=1,center=False,axis=0,method=single]
```

#### 1) 对整体聚合

您可以把一个聚合函数传递给 DataFrame，示例如下：

```python
#使用 aggregate()聚合操作
print(r.aggregate(np.sum))
```

输出结果：

```
                   A         B         C         D
2022-12-14  0.365679  1.605576  0.094622  1.367596
2022-12-15  0.362625  1.293926  1.570901  1.115170
2022-12-16  1.065348  1.738291  2.785181  0.225123
2022-12-17  0.433971 -1.041707  4.386011 -1.222374
2022-12-18  0.170139 -0.231719  1.106631 -2.266252
```

#### 2) 对任意某一列聚合

```python
#对 A 列聚合
print(r['A'].aggregate(np.sum))
```

输出结果：

```
2022-12-14    0.365679
2022-12-15    0.362625
2022-12-16    1.065348
2022-12-17    0.433971
2022-12-18    0.170139
Freq: D, Name: A, dtype: float64
```

#### 3) 对多列数据聚合

```python
#对 A/B 两列聚合
print(r['A','B'].aggregate(np.sum))
```

输出结果：

```
                   A         B
2022-12-14  0.365679  1.605576
2022-12-15  0.362625  1.293926
2022-12-16  1.065348  1.738291
2022-12-17  0.433971 -1.041707
2022-12-18  0.170139 -0.231719
```

#### 4) 对单列应用多个函数

```python
#对 A 列聚合
print(r['A'].aggregate([np.sum,np.mean]))
```

输出结果：

```
                 sum      mean
2022-12-14  0.365679  0.365679
2022-12-15  0.362625  0.181313
2022-12-16  1.065348  0.355116
2022-12-17  0.433971  0.144657
2022-12-18  0.170139  0.056713
```

#### 5) 对不同列应用多个函数

```python
#对 A/B 两列聚合
print(r['A','B'].aggregate([np.sum,np.mean]))
```

输出结果：

```
                   A                   B          
                 sum      mean       sum      mean
2022-12-14  0.365679  0.365679  1.605576  1.605576
2022-12-15  0.362625  0.181313  1.293926  0.646963
2022-12-16  1.065348  0.355116  1.738291  0.579430
2022-12-17  0.433971  0.144657 -1.041707 -0.347236
2022-12-18  0.170139  0.056713 -0.231719 -0.077240
```

#### 6) 对不同列应用不同函数

```python
print(r.aggregate({'A': np.sum,'B': np.mean}))
```

输出结果：

```
                   A         B
2022-12-14  0.365679  1.605576
2022-12-15  0.362625  0.646963
2022-12-16  1.065348  0.579430
2022-12-17  0.433971 -0.347236
2022-12-18  0.170139 -0.077240
```